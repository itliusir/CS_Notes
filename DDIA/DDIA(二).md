# 存储与检索

## 1. 索引

通过索引我们加快读查询的速度，但是每个索引都会拖慢写入速度。因此数据集默认不会索引所有的内容，而需要你手动选择索引来控制收益和开销。

- 哈希索引

  必须能放进内存，如果在磁盘上保存哈希索引，会造成大量的随机磁盘I/O

- LSM树

  写入时，将数据写入内存中有序的数据结构(红黑树、跳表)，然后内存的数据大于某个阈值时，将其写入磁盘。查找时先在内存中看是否存在，然后在最近的磁盘段中找，然后在下一个旧的段找，因为每段是有序的，可以根据键二分查找。

  可以大致看出存在两个问题：

  1. 出现某些问题导致内存中的数据还没来得及刷到磁盘，一般我们会采用一个单独日志记录，方便崩溃后恢复内存表的信息。
  2. 查找时候如果数据存在一个很老的段里，会导致效率很差，我们可以增加一层 Bloom 过滤器来提升性能。

- B树

  B树是使用最广泛的索引结构，保持了LSM中的按键排序，但是B树并没有像LSM中那些顺序读的块，而是把数据分解为固定大小的页，相互的页通过指针来引用，组成了一个页树。

  为了崩溃后能快速恢复，B树通常会使用 WAL(write-ahead-log, 预写式日志)



## 2. OLTP VS OLAP

在线事务处理(Online Transaction Processing) 和 在线分析处理(Online Analytice Processing) 主要属性区别如下：

![](http://qiniu.itliusir.com/ddia_oltp_olap.png)



### 2.1 数据仓库

数据仓库是一个独立的数据库，包含了公司各种 OLTP 系统中所有的只读数据副本。从 OLTP 数据库中提取数据，转换成适合分析的模式，清理并加载到数据仓库中，我们称这个过程为 **抽取-转换-加载(ETL)**。



